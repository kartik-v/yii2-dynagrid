/*!
 * @package   yii2-dynagrid
 * @author    Kartik Visweswaran <kartikv2@gmail.com>
 * @copyright Copyright &copy; Kartik Visweswaran, Krajee.com, 2015 - 2017
 * @version   1.4.6
 *
 * JQuery Plugin for yii2-dynagrid.
 * 
 * Author: Kartik Visweswaran
 * Copyright: 2015, Kartik Visweswaran, Krajee.com
 * For more JQuery plugins visit http://plugins.krajee.com
 * For more Yii related demos visit http://demos.krajee.com
 */!function(e){"use strict";var t,i;t={NAMESPACE:".dynagrid",isEmpty:function(t,i){return null===t||void 0===t||t===[]||""===t||i&&""===e.trim(t)},getFormObjectId:function(e){return e.attr("name").toLowerCase().replace(/-/g,"_")+"_activeform"},cacheActiveForm:function(e){var i=e.closest("form"),n=i.data("yiiActiveForm"),r=t.getFormObjectId(e);t.isEmpty(r)||t.isEmpty(n)||(window[r]=n)},handler:function(e,i,n){var r=t.NAMESPACE,o=i.split(" ").join(r+" ")+r;e&&e.length&&e.off(o).on(o,n)}},i=function(t,i){var n=this;n.$element=e(t),e.each(i,function(e,t){n[e]=t}),n.init(),n.listen()},i.prototype={constructor:i,init:function(){var i=this,n=e("#"+i.modalId),r=e("#"+i.dynaGridId),o=t.getFormObjectId(i.$element),s=i.$element.closest("form");i.$form=s,t.isEmpty(window[o])&&t.cacheActiveForm(i.$element),n.insertAfter(r),i.$visibleEl=s.find(".sortable-visible"),i.$hiddenEl=s.find(".sortable-hidden"),i.$visibleKeys=s.find('input[name="visibleKeys"]'),i.$btnSubmit=n.find(".dynagrid-submit"),i.$btnDelete=n.find(".dynagrid-delete"),i.$btnReset=n.find(".dynagrid-reset"),i.$formContainer=s.parent(),i._setColumnKeys(),i.visibleContent=i.$visibleEl.html(),i.hiddenContent=i.$hiddenEl.html(),i.visibleSortableOptions=window[i.$visibleEl.attr("data-krajee-sortable")],i.hiddenSortableOptions=window[i.$hiddenEl.attr("data-krajee-sortable")]},listen:function(){var i=this;t.handler(i.$btnSubmit,"click",e.proxy(i._submit,i)),t.handler(i.$btnDelete,"click",e.proxy(i._delete,i)),t.handler(i.$btnReset,"click",e.proxy(i._reset,i)),t.handler(i.$form,"keypress",function(e){var t=e.which||e.keyCode||0;13===t&&(e.preventDefault(),i._submit())}),t.handler(i.$form,"afterValidate",function(t,n){e.each(n,function(e,t){return t.length>0?(i.$form.show(),i.$formContainer.find(".dynagrid-submit-message").remove(),!0):void 0})})},_setColumnKeys:function(){var t=this;t.visibleKeys=t.$visibleEl.find("li").map(function(t,i){return e(i).attr("id")}).get().join(",")},_submitForm:function(e){var t=this,i=t.$form,n=t.$formContainer;i.hide(),n.prepend(e),setTimeout(function(){i.submit()},1e3)},_submit:function(){var e=this;e._setColumnKeys(),e.$visibleKeys.val(e.visibleKeys),e._submitForm(e.submitMessage)},_delete:function(){var e,t=this;window.confirm(t.deleteConfirmation)&&(e=$form.find('input[name="deleteFlag"]'),e&&e.length&&e.val(1),t._submitForm(t.deleteMessage))},_reset:function(){var e=this;e.$visibleEl.sortable("destroy").html(e.visibleContent),e.$hiddenEl.sortable("destroy").html(e.hiddenContent),e._setColumnKeys(),e.$formContainer.find(".dynagrid-submit-message").remove(),e.$visibleEl.sortable(e.visibleSortableOptions),e.$hiddenEl.sortable(e.hiddenSortableOptions),e.$form.trigger("reset.yiiActiveForm"),setTimeout(function(){e.$form.find("select").trigger("change")},100)}},e.fn.dynagrid=function(t){var n=Array.apply(null,arguments);return n.shift(),this.each(function(){var r=e(this),o=r.data("dynagrid"),s="object"==typeof t&&t;o||(o=new i(this,e.extend({},e.fn.dynagrid.defaults,s,e(this).data())),r.data("dynagrid",o)),"string"==typeof t&&o[t].apply(o,n)})},e.fn.dynagrid.defaults={submitMessage:"",deleteMessage:"",deleteConfirmation:"Are you sure you want to delete all your grid personalization settings?",modalId:"",dynaGridId:""}}(window.jQuery);