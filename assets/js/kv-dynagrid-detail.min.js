/*!
 * @package   yii2-dynagrid
 * @author    Kartik Visweswaran <kartikv2@gmail.com>
 * @copyright Copyright &copy; Kartik Visweswaran, Krajee.com, 2015 - 2018
 * @version   1.4.8
 *
 * JQuery Plugin for yii2-dynagridDetail. Allows saving/deleting the dynagridDetail 
 * filter or sort details.
 *
 * For more JQuery plugins visit http://plugins.krajee.com
 * For more Yii related demos visit http://demos.krajee.com
 */!function(t){"use strict";var e,i;e={isEmpty:function(e,i){return null===e||void 0===e||e===[]||""===e||i&&""===t.trim(e)},handler:function(t,e,i){var n=".dynagridDetail",a=e.split(" ").join(n+" ")+n;t&&t.length&&t.off(a).on(a,i)}},i=function(e,i){var n=this;n.$element=t(e),t.each(i,function(t,e){n[t]=e}),n.init(),n.listen()},i.prototype={constructor:i,init:function(){var e=this,i=t("#"+e.modalId),n=t("#"+e.dynaGridId),a=e.$element.closest("form");i.insertAfter(n),e.$form=a,e.$formContainer=a.parent(),e.$btnSave=a.find(".dynagrid-detail-save"),e.$btnDelete=a.find(".dynagrid-detail-delete"),e.$list=a.find(".dynagrid-detail-list"),e.$name=a.find(".dynagrid-detail-name")},process:function(e){var i=this;t.ajax({type:"post",url:e,dataType:"json",data:i.$form.serialize(),beforeSend:function(){i.$form.hide(),i.$formContainer.prepend(i.submitMessage)},success:function(t){"success"===t.status&&i.$formContainer.html(t.content)}})},listen:function(){var i=this;e.handler(i.$btnSave,"click",t.proxy(i._submit,i)),e.handler(i.$btnDelete,"click",t.proxy(i._delete,i)),e.handler(i.$list,"change",function(){var n=i.$form,a=t(this).val(),r=t(this).find("option:selected").text();e.isEmpty(a)||(i.$name.val(r),t.ajax({type:"post",url:i.configUrl,dataType:"json",data:n.serialize(),success:function(t){t.status&&n.find(".dynagrid-settings-text").html(t.content)}}))}),e.handler(i.$form,"afterValidate",function(e,n){t.each(n,function(t,e){return e.length>0?(i.$form.show(),i.$formContainer.find(".dynagrid-submit-message").remove(),!0):void 0})})},_submitForm:function(t){var e=this,i=e.$form,n=e.$formContainer;i.hide(),n.prepend(t),setTimeout(function(){i.submit()},1e3)},_submit:function(){var t=this;t._submitForm(t.submitMessage)},_delete:function(){var t,i=this,n=window[i.dialogLib];return e.isEmpty(i.$list.val())?void i.$form.trigger("reset.yiiActiveForm"):void n.confirm(i.deleteConfirmation,function(e){e&&(t=i.$form.find('input[name="deleteDetailFlag"]'),t&&t.length&&t.val(1),i._submitForm(i.deleteMessage))})}},t.fn.dynagridDetail=function(e){var n=Array.apply(null,arguments);return n.shift(),this.each(function(){var a=t(this),r=a.data("dynagridDetail"),o="object"==typeof e&&e;r||(r=new i(this,t.extend({},t.fn.dynagridDetail.defaults,o,t(this).data())),a.data("dynagridDetail",r)),"string"==typeof e&&r[e].apply(r,n)})},t.fn.dynagridDetail.defaults={submitMessage:"",deleteMessage:"",deleteConfirmation:"",configUrl:"",modalId:"",dynaGridId:"",dialogLib:"krajeeDialog"}}(window.jQuery);