/*!
 * @package   yii2-dynagrid
 * @author    Kartik Visweswaran <kartikv2@gmail.com>
 * @copyright Copyright &copy; Kartik Visweswaran, Krajee.com, 2015 - 2022
 * @version   1.5.3
 *
 * JQuery Plugin for yii2-dynagrid.
 * 
 * For more JQuery plugins visit http://plugins.krajee.com
 * For more Yii related demos visit http://demos.krajee.com
 */
!function(t){"use strict";var e,i;e={isEmpty:function(e,i){return null==e||e===[]||""===e||i&&""===t.trim(e)},getFormObjectId:function(t){return t.attr("name").toLowerCase().replace(/-/g,"_")+"_activeform"},cacheActiveForm:function(t){var i=t.closest("form").data("yiiActiveForm"),n=e.getFormObjectId(t);e.isEmpty(n)||e.isEmpty(i)||(window[n]=i)},handler:function(t,e,i){var n=".dynagrid",s=e.split(" ").join(n+" ")+n;t&&t.length&&t.off(s).on(s,i)}},(i=function(e,i){var n=this;n.$element=t(e),t.each(i,function(t,e){n[t]=e}),n.init(),n.listen()}).prototype={constructor:i,init:function(){var i=t("#"+this.modalId),n=t("#"+this.dynaGridId),s=e.getFormObjectId(this.$element),r=this.$element.closest("form");this.$form=r,e.isEmpty(window[s])&&e.cacheActiveForm(this.$element),i.insertAfter(n),this.$visibleEl=r.find(".sortable-visible"),this.$hiddenEl=r.find(".sortable-hidden"),this.$visibleKeys=r.find('input[name="visibleKeys"]'),this.$btnSubmit=i.find(".dynagrid-submit"),this.$btnDelete=i.find(".dynagrid-delete"),this.$btnReset=i.find(".dynagrid-reset"),this.$formContainer=r.parent(),this._setColumnKeys(),this.visibleContent=this.$visibleEl.html(),this.hiddenContent=this.$hiddenEl.html(),this.visibleSortableOptions=window[this.$visibleEl.attr("data-krajee-sortable")],this.hiddenSortableOptions=window[this.$hiddenEl.attr("data-krajee-sortable")]},listen:function(){var i=this;e.handler(i.$btnSubmit,"click",t.proxy(i._submit,i)),e.handler(i.$btnDelete,"click",t.proxy(i._delete,i)),e.handler(i.$btnReset,"click",t.proxy(i._reset,i)),e.handler(i.$form,"keypress",function(t){13===(t.which||t.keyCode||0)&&(t.preventDefault(),i._submit())}),e.handler(i.$form,"afterValidate",function(e,n){t.each(n,function(t,e){if(e.length>0)return i.$form.show(),i.$formContainer.find(".dynagrid-submit-message").remove(),!0})})},_setColumnKeys:function(){this.visibleKeys=this.$visibleEl.find("li").map(function(e,i){return t(i).attr("id")}).get().join(",")},_submitForm:function(t){var e=this.$form,i=this.$formContainer;e.hide(),i.prepend(t),setTimeout(function(){e.submit()},1e3)},_submit:function(){this._setColumnKeys(),this.$visibleKeys.val(this.visibleKeys),this._submitForm(this.submitMessage)},_delete:function(){var t,e=this;window[e.dialogLib].confirm(e.deleteConfirmation,function(i){i&&((t=e.$form.find('input[name="deleteFlag"]'))&&t.length&&t.val(1),e._submitForm(e.deleteMessage))})},_reset:function(){var t=this.$visibleEl,e=this.$hiddenEl,i=this.$form;t.kvHtml5Sortable("destroy"),t.html(this.visibleContent),e.kvHtml5Sortable("destroy"),e.html(this.hiddenContent),this._setColumnKeys(),this.$formContainer.find(".dynagrid-submit-message").remove(),t.kvHtml5Sortable(this.visibleSortableOptions),e.kvHtml5Sortable(this.hiddenSortableOptions),i.trigger("reset.yiiActiveForm"),setTimeout(function(){i.find("select").trigger("change")},100)},reset:function(){var i=this.$element.closest("form"),n=e.getFormObjectId(this.$element),s=window[n];e.isEmpty(s)||(i.yiiActiveForm("destroy"),i.yiiActiveForm(s.attributes,s.settings)),i.find("select[data-krajee-select2]").each(function(){var e=t(this),i=window[e.attr("data-krajee-select2")]||{};e.data("select2")&&e.select2("destroy"),t.when(e.select2(i)).done(function(){initS2Loading(e.attr("id"),".select2-container--krajee")})}),i.find("[data-krajee-kvHtml5Sortable]").each(function(){var e=t(this);e.data("kvHtml5Sortable")&&e.kvHtml5Sortable("destroy"),e.kvHtml5Sortable(window[e.attr("data-krajee-kvHtml5Sortable")])})}},t.fn.dynagrid=function(e){var n=Array.apply(null,arguments);return n.shift(),this.each(function(){var s=t(this),r=s.data("dynagrid"),o="object"==typeof e&&e;r||(r=new i(this,t.extend({},t.fn.dynagrid.defaults,o,t(this).data())),s.data("dynagrid",r)),"string"==typeof e&&r[e].apply(r,n)})},t.fn.dynagrid.defaults={submitMessage:"",deleteMessage:"",deleteConfirmation:"",modalId:"",dynaGridId:"",dialogLib:"krajeeDialog"}}(window.jQuery);